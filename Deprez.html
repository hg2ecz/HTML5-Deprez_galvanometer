<!DOCTYPE html>
<html>
<head>
  <title>Deprez műszer</title>
  <meta charset="utf8">
</head>
<body>
<p>Deprez műszer - értékeit később Raspberry Pi-re akasztott mérőáramkörről kaphatja.</p>

<canvas id="rajz1" width="640" height="400" style="border:1px solid #d3d3d3;">A böngésződ még nem képes a HTML5 alapjaira. Próbálkozz például egy friss Firefox böngészővel.</canvas>

<script language="javascript">
// Author: Krüpl Zsolt <hg2ecz@ham.hu>, 2016
function deprez_init() {
  var element=document.getElementById("rajz1");
  var c=element.getContext("2d");

  height = element.height;
  width = element.width;
  center = 0.9;
  ptrlen = 0.9*center;
  visibleY = (2*center-1)*height;

  return c;
}

function deprez(value, minvalue, maxvalue, scalastep, scalatick, unit) {
  c.fillStyle="#FFFFFF";
  c.fillRect(0, 0, width, height);
  c.fillStyle="#000000";
  c.fillRect(0, visibleY, width, height);


  c.save();
  c.beginPath();
  c.lineWidth=1;
  c.strokeStyle="black";
  c.arc(width/2, height*center, height*ptrlen*.97, (1.5-1/3)*Math.PI, (1.5+1/3)*Math.PI);
  c.font="60px Arial";
  c.textAlign = "center";
  c.fillText(unit, width/2, height/2);
  c.stroke();
  c.closePath();
  c.restore();

  c.beginPath();
  c.lineWidth=2;
  c.strokeStyle="black";
  for (var i=minvalue; i<=maxvalue; i+=scalatick) {
    radian = (120*i/(maxvalue-minvalue))/180*Math.PI;
    x = width/2 + height*ptrlen*.97*Math.sin(radian);
    y = height*(center - ptrlen*.97*Math.cos(radian));
    c.moveTo(x, y);

    x = width/2 + height*ptrlen*1.0*Math.sin(radian);
    y = height*(center - ptrlen*1.0*Math.cos(radian));
    c.lineTo(x, y);
  }
  c.stroke();
  c.closePath();

  c.beginPath();
  c.lineWidth=3;
  c.strokeStyle="black";
  c.textAlign = "center";
  for (var i=minvalue; i<=maxvalue; i+=scalastep) {
    radian = (120*i/(maxvalue-minvalue))/180*Math.PI;
    x = width/2 + height*ptrlen*.97*Math.sin(radian);
    y = height*(center - ptrlen*.97*Math.cos(radian));
    c.moveTo(x, y);

    x = width/2 + height*ptrlen*1.03*Math.sin(radian);
    y = height*(center - ptrlen*1.03*Math.cos(radian));
    c.lineTo(x, y);

    x = width/2 + height*ptrlen*1.06*Math.sin(radian);
    y = height*(center - ptrlen*1.06*Math.cos(radian));
    c.fillText(i, x, y);
  }
  c.stroke();
  c.closePath();

  radian = (120*value/(maxvalue-minvalue))/180*Math.PI;
  x_start = width/2+(height*center-visibleY)*Math.tan(radian);
  x = width/2 + height*ptrlen*Math.sin(radian);
  y = height*(center - ptrlen*Math.cos(radian));

  c.beginPath();
  c.lineWidth=2;
  c.strokeStyle="red";
  c.moveTo(x_start, visibleY);
  c.lineTo(x, y);
  c.stroke();
  c.closePath();
}

function deprezrefresh() {
    deprez(val, -5, 5, 1, 0.2, "V");
    val+=diff;
    if (val > 5 || val < -5) diff=-diff;
}

var val=0;
var diff=0.02;
var c=deprez_init();
deprezrefresh();
setInterval(deprezrefresh, 50);
</script>

</body>
</html>
